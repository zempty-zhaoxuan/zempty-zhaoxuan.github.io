<!DOCTYPE html>
<html lang="zh-CN">
  {% include head.html %}
  <body>
    <script>
      // Set theme on body right away to prevent FOUC
      (function () {
        try {
          var stored = localStorage.getItem('theme');
          var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          var cls = document.body.classList;
          // Ensure we don't wipe other classes
          cls.remove('dark-theme', 'light-theme');

          if (stored === 'dark-theme' || stored === 'light-theme') {
            cls.add(stored);
          } else {
            // Keep previous behavior: default to dark when not set
            cls.add('dark-theme');
            localStorage.setItem('theme', 'dark-theme');
          }
        } catch (e) {
          // Fallback to dark theme if storage unavailable
          document.body.classList.add('dark-theme');
        }
      })();
    </script>
    <style>
      /* æ–‡å­—é€‰ä¸­æ ·å¼ä¼˜åŒ– - ç¡®ä¿è‰¯å¥½çš„å¯¹æ¯”åº¦ */
      ::-moz-selection {
        color: #ffffff !important;
        background: #1971c2 !important;
      }

      ::selection {
        color: #ffffff !important;
        background: #1971c2 !important;
      }

      /* æ·±è‰²ä¸»é¢˜ä¸‹çš„æ–‡å­—é€‰ä¸­ä¼˜åŒ– */
      .dark-theme ::-moz-selection {
        color: #1a1a1a !important;
        background: #74c0fc !important;
      }

      .dark-theme ::selection {
        color: #1a1a1a !important;
        background: #74c0fc !important;
      }
    </style>
    {% include nav.html %} {% if page.toc==true %}
    <aside class="toc">
      <button
        id="toc-toggle-button"
        aria-label="å±•å¼€/æŠ˜å ç›®å½•"
        title="å±•å¼€/æŠ˜å ç›®å½•"
      >
        ç›®å½• â–¼
      </button>
      <div id="toc-content">{% include toc.html html=content %}</div>
    </aside>
    {% endif %}

    <div id="main" role="main" class="wrapper-content page-transition">
      <div class="container">
        <div class="loader"></div>
        {{ content }}
      </div>
    </div>

    <!-- å³ä¸‹è§’æµ®åŠ¨æŒ‰é’®ç»„ -->
    <div class="floating-buttons">
      <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
      <a
        href="{{ site.baseurl }}/"
        id="home-button"
        aria-label="è¿”å›é¦–é¡µ"
        title="è¿”å›é¦–é¡µ"
        >ğŸ </a
      >

      <!-- æ¡Œé¢ç«¯ä¾§è¾¹æ æŠ˜å æŒ‰é’® (æ°´å¹³æŠ˜å ) -->
      <button
        id="sidebar-toggle"
        aria-label="æŠ˜å /å±•å¼€ä¾§è¾¹æ "
        title="æŠ˜å /å±•å¼€ä¾§è¾¹æ "
      >
        â˜°
      </button>

      <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ æŠ˜å æŒ‰é’® (å‚ç›´æŠ˜å ) -->
      <button
        id="mobile-sidebar-toggle"
        aria-label="æŠ˜å /å±•å¼€ä¾§è¾¹æ "
        title="æŠ˜å /å±•å¼€ä¾§è¾¹æ "
      >
        â–¼
      </button>

      <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
      <button
        id="theme-toggle"
        aria-label="åˆ‡æ¢æ·±è‰²/æµ…è‰²ä¸»é¢˜"
        title="åˆ‡æ¢æ·±è‰²/æµ…è‰²ä¸»é¢˜"
      >
        ğŸŒ™
      </button>
    </div>

    {% include analytics.html %}

    <!-- å¼•å…¥ä¸»é¢˜åˆ‡æ¢è„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/theme-switcher.js" defer></script>

    <!-- å¼•å…¥ä¾§è¾¹æ æŠ˜å è„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/sidebar-toggle.js" defer></script>

    <!-- å¼•å…¥åŠ¨ç”»æ•ˆæœè„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/animation-loader.js" defer></script>

    <!-- å¼•å…¥é˜…è¯»è¿›åº¦æ¡è„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/reading-progress.js" defer></script>

    <!-- å¼•å…¥ä»£ç å¢å¼ºè„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/code-enhancements.js" defer></script>

    <!-- å¼•å…¥ç§»åŠ¨ç«¯å¢å¼ºè„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/mobile-enhancements.js" defer></script>

    <!-- å¼•å…¥ç°ä»£åŒ–å¢å¼ºè„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/modern-enhancements.js" defer></script>

    <!-- å¼•å…¥æ‡’åŠ è½½è„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/lazy-load.js" defer></script>

    <!-- å¼•å…¥ç°ä»£åŒ–æœç´¢è„šæœ¬ -->
    <script src="{{ site.baseurl }}/js/modern-search.js" defer></script>

    <!-- å¼•å…¥TOCæŠ˜å è„šæœ¬ -->
    {% if page.toc==true %}
    <script src="{{ site.baseurl }}/js/toc-toggle.js" defer></script>
    {% endif %}

    <!-- åŠ¨æ€è°ƒæ•´ç›®å½•åŒºåŸŸè„šæœ¬ -->
    {% if page.toc==true %}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // è·å–ç›¸å…³å…ƒç´ 
        const toc = document.querySelector(".toc");
        const mainContent = document.querySelector(".wrapper-content");
        const container = document.querySelector(".container");

        // è‡ªé€‚åº”ç›®å½•åŒºåŸŸå¤§å°çš„å‡½æ•°
        function adjustTocSize() {
          // è·å–å†…å®¹åŒºåŸŸçš„å®½åº¦
          const contentWidth = mainContent.offsetWidth;
          // è·å–å®¹å™¨å®½åº¦
          const containerWidth = container.offsetWidth;
          // è®¡ç®—å†…å®¹åŒºåŸŸçš„ç©ºç™½éƒ¨åˆ†
          const availableSpace = contentWidth - containerWidth;

          // å¦‚æœæœ‰è¶³å¤Ÿçš„ç©ºç™½ï¼Œå¢åŠ ç›®å½•åŒºåŸŸçš„å®½åº¦
          if (availableSpace > 100) {
            // è®¡ç®—å¯ç”¨çš„é¢å¤–ç©ºé—´ï¼Œæœ€å¤šå¢åŠ 100px
            const extraSpace = Math.min(availableSpace * 0.7, 100);
            toc.style.width = 320 + extraSpace + "px";
          } else {
            // å¦åˆ™ä½¿ç”¨é»˜è®¤å®½åº¦
            toc.style.width = "";
          }
        }

        // é¡µé¢åŠ è½½å’Œçª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´
        adjustTocSize();
        window.addEventListener("resize", adjustTocSize);

        // ç›‘å¬å†…å®¹å˜åŒ–ï¼ˆå¦‚å›¾ç‰‡åŠ è½½å®Œæˆç­‰ï¼‰
        const observer = new MutationObserver(adjustTocSize);
        observer.observe(mainContent, { childList: true, subtree: true });
      });
    </script>
    {% endif %}
  </body>

  {% if page.toc==true %}
  <script>
    document.getElementById("main").classList.add("withtoc");
  </script>
  {% endif %}

  <div class="wrapper-footer-mobile">
    <footer class="footer">{% include footer.html %}</footer>
  </div>
</html>
