{% if site.gitalk %}
<div class="comments">
  <div id="gitalk-container"></div>
  <script>
    (function(){
      function loadScript(src){
        return new Promise(function(resolve, reject){
          var s = document.createElement('script');
          s.src = src; s.async = true; s.onload = resolve; s.onerror = reject;
          document.head.appendChild(s);
        });
      }
      document.addEventListener('DOMContentLoaded', function(){
        Promise.resolve()
          .then(function(){ return loadScript('https://cdn.jsdelivr.net/npm/blueimp-md5@2.19.0/js/md5.min.js'); })
          .then(function(){ return loadScript('https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js'); })
          .then(function(){
            var gitalk = new Gitalk({
              clientID: '{{ site.gitalk.clientID }}',
              clientSecret: '{{ site.gitalk.clientSecret }}',
              repo: '{{ site.gitalk.repo }}',
              owner: '{{ site.gitalk.owner }}',
              admin: ['{{ site.gitalk.owner }}'],
              id: md5(window.location.pathname),
              distractionFreeMode: false,
              title: '{{ page.title }}',
              language: 'zh-CN'
            });
            gitalk.render('gitalk-container');
          });
      });
    })();
  </script>
</div>
{% endif %}
